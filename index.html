<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ù…Ø§Ø´ - Ø³Ø§Ø¯Ø© ÙˆÙ…Ø·Ø¨ÙˆØ¹ (Firebase)</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f5f5f7;
    }

    header {
      background: #222;
      color: #fff;
      padding: 14px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      font-size: 18px;
      margin: 0;
    }

    nav button {
      margin-right: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      background: #444;
      color: #fff;
    }

    nav button.active {
      background: #4b7bec;
      color: #fff;
    }

    .container {
      max-width: 1100px;
      margin: 20px auto;
      padding: 0 16px 40px;
    }

    .card {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.06);
      margin-bottom: 20px;
    }

    .card h2 {
      margin-top: 0;
      font-size: 18px;
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      box-sizing: border-box;
      margin-bottom: 12px;
    }

    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .col {
      flex: 1;
      min-width: 220px;
    }

    button.primary {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      background: #4b7bec;
      color: #fff;
      margin-top: 8px;
    }

    button.primary:hover {
      opacity: 0.9;
    }

    .msg {
      margin-top: 10px;
      font-size: 13px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    table thead {
      background: #f1f2f6;
    }

    th, td {
      padding: 8px;
      border-bottom: 1px solid #ececec;
      text-align: center;
    }

    .hidden {
      display: none;
    }

    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #ffeaa7;
    }

    .badge-formed {
      background: #55efc4;
    }

    .badge-not-formed {
      background: #ff7675;
      color: #fff;
    }

    .small-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 11px;
      margin: 0 2px;
      background: #dfe4ea;
    }

    .small-btn.delete {
      background: #ff7675;
      color: #fff;
    }

    .small-btn.edit {
      background: #74b9ff;
      color: #fff;
    }

    .small-btn.receive {
      background: #55efc4;
      color: #000;
    }

    .small-btn.unreceive {
      background: #fab1a0;
      color: #000;
    }

    .small-btn.form {
      background: #ffeaa7;
      color: #000;
    }

    /* ğŸ”½ AutoComplete Ù„Ù„Ø®Ø§Ù…Ø© */
    .autocomplete-wrapper {
      position: relative;
    }

    .suggestions {
      position: absolute;
      top: 100%;
      right: 0;
      left: 0;
      background: #fff;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      max-height: 200px;
      overflow-y: auto;
      z-index: 20;
    }

    .suggestion-item {
      padding: 6px 10px;
      cursor: pointer;
      font-size: 13px;
      text-align: right;
    }

    .suggestion-item:hover {
      background: #f1f2f6;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„ØªØ±Ø© */
    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .filter-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
      font-size: 12px;
    }

    .filter-btn.active {
      background: #4b7bec;
      color: #fff;
      border-color: #4b7bec;
    }

    .filter-input {
      max-width: 180px;
    }

    /* Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
    .totals {
      margin-top: 6px;
      font-size: 13px;
      text-align: left;
      color: #333;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ù…Ø§Ø´</h1>
    <nav>
      <button id="nav-solid" class="active">Ù‚Ù…Ø§Ø´ Ø³Ø§Ø¯Ø©</button>
      <button id="nav-printed">Ù‚Ù…Ø§Ø´ Ù…Ø·Ø¨ÙˆØ¹</button>
    </nav>
  </header>

  <div class="container">

    <!-- ØµÙØ­Ø© Ø§Ù„Ù‚Ù…Ø§Ø´ Ø§Ù„Ø³Ø§Ø¯Ø© -->
    <section id="page-solid" class="card">
      <h2>Ù‚Ù…Ø§Ø´ Ø³Ø§Ø¯Ø© - Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ ÙˆØ§Ø­Ø¯ ÙˆØ¬Ø¯Ø§ÙˆÙ„ Ø¹Ø±Ø¶ Ù…Ø®ØªÙ„ÙØ©</h2>

      <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·) -->
      <h3>Ø¥Ø¯Ø®Ø§Ù„ / ØªØ¹Ø¯ÙŠÙ„ Ø·Ù„Ø¨ Ø³Ø§Ø¯Ø©</h3>

      <div class="row">
        <div class="col">
          <label for="solidColorText">Ø§Ù„Ù„ÙˆÙ† (ÙƒØªØ§Ø¨Ø©):</label>
          <input type="text" id="solidColorText" placeholder="Ù…Ø«Ø§Ù„: Ø±ÙˆØ² Ø¨ÙŠÚ†ØŒ Ø£Ø®Ø¶Ø± Ø²ÙŠØªÙˆÙ†ÙŠ..." />
        </div>
       <div class="col">
  <label for="solidColorCode">ÙƒÙˆØ¯ Ø§Ù„Ù„ÙˆÙ† (Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ¨ØºØ©) <span style="font-size:11px;color:#888;">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>:</label>
  <input
    type="text"
    id="solidColorCode"
    class="normalize-digits"
    inputmode="numeric"
    placeholder="Ù…Ø«Ø§Ù„: 101311"
/>
</div>

      </div>

      <div class="row">
        <div class="col">
          <label for="solidForWhom">Ù„ØµØ§Ù„Ø­ Ù…ÙŠÙ† (Ø¹Ù…ÙŠÙ„ / Ù…Ø­Ù„ / Ù…Ø®Ø²Ù†):</label>
          <input type="text" id="solidForWhom" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„" />
        </div>
        <div class="col">
          <label for="solidPattern">Ø§Ù„Ø±Ø³Ù…Ø©:</label>
          <input type="text" id="solidPattern" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø¯Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø¨Ø±Ù† Ø£ÙˆØªØŒ Ø¬Ø§ÙƒØ§Ø± Ø¨Ø³ÙŠØ·..." />
        </div>
        <div class="col">
          <label for="solidQuality">Ø§Ù„Ø®Ø§Ù…Ø©:</label>
          <div class="autocomplete-wrapper">
            <input type="text" id="solidQuality" placeholder="Ù…Ø«Ø§Ù„: DTYØŒ Ù‚Ø·Ù† 100%ØŒ ÙØ³ÙƒÙˆØ²..." autocomplete="off" />
            <div id="qualitySuggestions" class="suggestions hidden"></div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="solidStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</label>
          <select id="solidStatus">
            <option value="">Ø§Ø®ØªØ§Ø± Ø§Ù„Ø­Ø§Ù„Ø©...</option>
            <option value="Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„</option>
            <option value="ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ§Øª">ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ§Øª</option>
            <option value="ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„">ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„</option>
          </select>
        </div>
        <div class="col">
          <label for="solidDate">ØªØ§Ø±ÙŠØ® ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨:</label>
          <input type="date" id="solidDate" />
        </div>
        <div class="col">
  <label for="solidQtyKg">Ø§Ù„ÙƒÙ…ÙŠØ© (ÙƒØº):</label>
  <input
    type="text"
    id="solidQtyKg"
    class="normalize-digits"
    inputmode="decimal"
    placeholder="Ù…Ø«Ø§Ù„: 250"
/>
</div>

      </div>

      <button class="primary" id="solidSaveBtn">Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ (Ø³Ø§Ø¯Ø©)</button>
      <div class="msg" id="solidMsg"></div>

      <hr style="margin: 24px 0;" />

      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ§Øª -->
      <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ§Øª (Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ = ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ§Øª)</h3>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ù„ÙˆÙ†</th>
            <th>ÙƒÙˆØ¯ Ø§Ù„Ù„ÙˆÙ†</th>
            <th>Ø§Ù„Ø®Ø§Ù…Ø©</th>
            <th>Ù„ØµØ§Ù„Ø­ Ù…ÙŠÙ†</th>
            <th>Ø§Ù„Ø±Ø³Ù…Ø©</th>
            <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ© (ÙƒØº)</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="labTableBody"></tbody>
      </table>
      <div class="totals" id="labTotals"></div>

      <hr style="margin: 24px 0;" />

      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª -->
      <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª / Ø§Ù„Ø¥Ù†ØªØ§Ø¬ (Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ = ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„ Ø£Ùˆ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„)</h3>

      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… + ÙÙ„Ø§ØªØ± Ø¥Ø¶Ø§ÙÙŠØ© -->
      <div class="filter-bar">
        <span>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:</span>
        <button class="filter-btn active" id="filterAll">Ø§Ù„ÙƒÙ„</button>
        <button class="filter-btn" id="filterReceived">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù…Ù‡</button>
        <button class="filter-btn" id="filterNotReceived">Ù„Ù… ÙŠØ³ØªÙ„Ù… Ø¨Ø¹Ø¯</button>
      </div>

      <div class="filter-bar">
        <span>ÙÙ„ØªØ±Ø© Ø¥Ø¶Ø§ÙÙŠØ©:</span>
        <input type="text" id="filterClient" class="filter-input" placeholder="Ù„ØµØ§Ù„Ø­ Ù…ÙŠÙ†..." />
        <input type="text" id="filterQuality" class="filter-input" placeholder="Ø§Ù„Ø®Ø§Ù…Ø©..." />
        <span>Ù…Ù†:</span>
        <input type="date" id="filterDateFrom" class="filter-input" />
        <span>Ø¥Ù„Ù‰:</span>
        <input type="date" id="filterDateTo" class="filter-input" />
        <button class="filter-btn" id="filterReset">Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ù„ÙˆÙ†</th>
            <th>ÙƒÙˆØ¯ Ø§Ù„Ù„ÙˆÙ†</th>
            <th>Ø§Ù„Ø®Ø§Ù…Ø©</th>
            <th>Ù„ØµØ§Ù„Ø­ Ù…ÙŠÙ†</th>
            <th>Ø§Ù„Ø±Ø³Ù…Ø©</th>
            <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ© (ÙƒØº)</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="solidTableBody"></tbody>
      </table>
      <div class="totals" id="solidTotals"></div>
    </section>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù‚Ù…Ø§Ø´ Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹ (Ù„Ø§Ø­Ù‚Ù‹Ø§) -->
    <section id="page-printed" class="card hidden">
      <h2>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ù…Ø§Ø´ Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹</h2>
      <p style="font-size:14px;">
        Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§ ÙÙ‚Ø· Ù„Ù„ØªØ¬Ù‡ÙŠØ². Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù†Ø¶ÙŠÙ Ù†Ù…ÙˆØ°Ø¬ ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø·Ø¨ÙˆØ¹.
      </p>
    </section>

  </div>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>

	// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ù†Ø¯ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
function normalizeArabicDigits(str) {
  if (!str) return "";
  const arabic = "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©";
  const english = "0123456789";
  return str.replace(/[Ù -Ù©]/g, d => english[arabic.indexOf(d)]);
}

    /************ ØªÙ‡ÙŠØ¦Ø© Firebase ************/
    const firebaseConfig = {
      apiKey: "AIzaSyAiidqHba1MY8D_AnbOv3DWSOjaeGXwB7A",
      authDomain: "adlatex-fabric-tracking.firebaseapp.com",
      projectId: "adlatex-fabric-tracking",
      storageBucket: "adlatex-fabric-tracking.firebasestorage.app",
      messagingSenderId: "448342410940",
      appId: "1:448342410940:web:06d676113caad3d82d72b9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    /************ Ø¯Ø§Ù„Ø© ØªØ±Ø¬Ø¹ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ø¨ØµÙŠØºØ© input date ************/
    function todayISO() {
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }

    /************ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø³Ø§Ø¯Ø© / Ù…Ø·Ø¨ÙˆØ¹ ************/
    const navSolid   = document.getElementById("nav-solid");
    const navPrinted = document.getElementById("nav-printed");
    const pageSolid  = document.getElementById("page-solid");
    const pagePrinted= document.getElementById("page-printed");

    function showSolid() {
      navSolid.classList.add("active");
      navPrinted.classList.remove("active");
      pageSolid.classList.remove("hidden");
      pagePrinted.classList.add("hidden");
    }

    function showPrinted() {
      navPrinted.classList.add("active");
      navSolid.classList.remove("active");
      pagePrinted.classList.remove("hidden");
      pageSolid.classList.add("hidden");
    }

    navSolid.addEventListener("click", showSolid);
    navPrinted.addEventListener("click", showPrinted);

    /************ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ************/
    const solidColorText = document.getElementById("solidColorText");
    const solidColorCode = document.getElementById("solidColorCode");
    const solidForWhom   = document.getElementById("solidForWhom");
    const solidPattern   = document.getElementById("solidPattern");
    const solidQuality   = document.getElementById("solidQuality");
    const solidStatus    = document.getElementById("solidStatus");
    const solidDate      = document.getElementById("solidDate");
    const solidQtyKg     = document.getElementById("solidQtyKg");
    const solidSaveBtn   = document.getElementById("solidSaveBtn");
    const solidMsg       = document.getElementById("solidMsg");

    const labTableBody   = document.getElementById("labTableBody");
    const solidTableBody = document.getElementById("solidTableBody");
    const labTotals      = document.getElementById("labTotals");
    const solidTotals    = document.getElementById("solidTotals");

    const qualitySuggestions = document.getElementById("qualitySuggestions");

    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø©
    const filterAll         = document.getElementById("filterAll");
    const filterReceived    = document.getElementById("filterReceived");
    const filterNotReceived = document.getElementById("filterNotReceived");

    // ÙÙ„Ø§ØªØ± Ø¥Ø¶Ø§ÙÙŠØ©
    const filterClient    = document.getElementById("filterClient");
    const filterQualityF  = document.getElementById("filterQuality");
    const filterDateFrom  = document.getElementById("filterDateFrom");
    const filterDateTo    = document.getElementById("filterDateTo");
    const filterReset     = document.getElementById("filterReset");

    let solidOrders = [];   // [{id, data}, ...]
    let solidEditId = null; // null = Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
    let qualityList = [];   // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø§Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
    let solidFilter = "all"; // all | received | not_received

    let filterClientText = "";
    let filterQualityText = "";
    let filterDateFromVal = "";
    let filterDateToVal   = "";

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    solidDate.value = todayISO();

    function clearSolidForm() {
      solidColorText.value = "";
      solidColorCode.value = "";
      solidForWhom.value   = "";
      solidPattern.value   = "";
      solidQuality.value   = "";
      solidStatus.value    = "";
      solidDate.value      = todayISO();  // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      solidQtyKg.value     = "";
      solidEditId          = null;
      solidSaveBtn.textContent = "Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ (Ø³Ø§Ø¯Ø©)";
    }

    function renderTables() {
      renderLabTable();
      renderSolidTable();
      buildQualityList();
    }

    // Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø§Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    function buildQualityList() {
      const set = new Set();
      solidOrders.forEach(o => {
        const q = o.data.quality && o.data.quality.trim();
        if (q) set.add(q);
      });
      qualityList = Array.from(set).sort((a, b) => a.localeCompare(b, "ar"));
    }

    // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ§Øª + Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    function renderLabTable() {
      labTableBody.innerHTML = "";
      let counter = 1;
      let totalQty = 0;
      let totalCount = 0;

      solidOrders.forEach((o) => {
        const order = o.data;
        const id    = o.id;
        if (order.status !== "ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ§Øª") return;

        totalCount++;
        totalQty += Number(order.qtyKg || 0);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${counter++}</td>
          <td>${order.colorText}</td>
          <td>${order.colorCode || "â€”"}</td>
          <td>${order.quality || "â€”"}</td>
          <td>${order.forWhom}</td>
          <td>${order.pattern}</td>
          <td><span class="badge">${order.status}</span></td>
          <td>${order.date}</td>
          <td>${order.qtyKg}</td>
          <td>
            <button class="small-btn form" data-id="${id}" data-action="form">ØªØ´ÙƒÙŠÙ„</button>
            <button class="small-btn edit" data-id="${id}" data-action="edit">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="small-btn delete" data-id="${id}" data-action="delete">Ø­Ø°Ù</button>
          </td>
        `;
        labTableBody.appendChild(tr);
      });

      labTotals.textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­ÙˆØ§Ø¶: ${totalCount} | Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©: ${totalQty} ÙƒØº`;
    }

    // Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª + Ø§Ù„ÙÙ„Ø§ØªØ± + Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    function renderSolidTable() {
      solidTableBody.innerHTML = "";
      let counter = 1;
      let totalQty = 0;
      let totalCount = 0;

      solidOrders.forEach((o) => {
        const order = o.data;
        const id    = o.id;

        // ÙÙ‚Ø· Ø§Ù„Ø­Ø§Ù„Ø§Øª: ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„ Ø£Ùˆ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„
        if (order.status !== "ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„" && order.status !== "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„") return;

        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
        if (solidFilter === "received" && !order.receivedAt) return;
        if (solidFilter === "not_received" && order.receivedAt) return;

        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„
        if (filterClientText) {
          const fw = (order.forWhom || "").toLowerCase();
          if (!fw.includes(filterClientText)) return;
        }

        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø®Ø§Ù…Ø©
        if (filterQualityText) {
          const q = (order.quality || "").toLowerCase();
          if (!q.includes(filterQualityText)) return;
        }

        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù…Ù† / Ø¥Ù„Ù‰) Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ order.date Ø¨ØµÙŠØºØ© YYYY-MM-DD
        if (filterDateFromVal && order.date && order.date < filterDateFromVal) return;
        if (filterDateToVal && order.date && order.date > filterDateToVal) return;

        totalCount++;
        totalQty += Number(order.qtyKg || 0);

        // Ù„ÙˆÙ† Ø§Ù„Ø­Ø§Ù„Ø©
        let badgeClass = "badge";
        if (order.status === "ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„") badgeClass = "badge badge-formed";
        if (order.status === "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„") badgeClass = "badge badge-not-formed";

        // Ø®Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
        let receivedCellHtml = "";
        if (order.status === "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„") {
          receivedCellHtml = "â€”";
        } else {
          if (order.receivedAt) {
            receivedCellHtml = `
              <div>${order.receivedAt}</div>
              <button class="small-btn unreceive" data-id="${id}" data-action="unreceive">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>
            `;
          } else {
            receivedCellHtml = `
              <button class="small-btn receive" data-id="${id}" data-action="receive">ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>
            `;
          }
        }

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙÙŠ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª
        let actionsHtml = `
          <button class="small-btn edit" data-id="${id}" data-action="edit">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="small-btn delete" data-id="${id}" data-action="delete">Ø­Ø°Ù</button>
        `;
        // Ù„Ùˆ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„ Ù†Ø¶ÙŠÙ Ø²Ø± "ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„"
        if (order.status === "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„") {
          actionsHtml =
            `<button class="small-btn form" data-id="${id}" data-action="form">ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„</button>` +
            actionsHtml;
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${counter++}</td>
          <td>${order.colorText}</td>
          <td>${order.colorCode || "â€”"}</td>
          <td>${order.quality || "â€”"}</td>
          <td>${order.forWhom}</td>
          <td>${order.pattern}</td>
          <td><span class="${badgeClass}">${order.status}</span></td>
          <td>${order.date}</td>
          <td>${order.qtyKg}</td>
          <td>${receivedCellHtml}</td>
          <td>${actionsHtml}</td>
        `;
        solidTableBody.appendChild(tr);
      });

      solidTotals.textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­ÙˆØ§Ø¶: ${totalCount} | Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©: ${totalQty} ÙƒØº`;
    }

    // Ø­ÙØ¸ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨
    async function saveSolidOrder() {
      // Ø§Ø­ØªÙØ§Ø¸ Ø¨ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      let existingReceivedAt = null;
      if (solidEditId !== null) {
        const existing = solidOrders.find(o => o.id === solidEditId);
        if (existing && existing.data.receivedAt) {
          existingReceivedAt = existing.data.receivedAt;
        }
      }
solidQtyKg.value = normalizeArabicDigits(solidQtyKg.value);
solidColorCode.value = normalizeArabicDigits(solidColorCode.value);

      const data = {
        colorText: solidColorText.value.trim(),
        colorCode: solidColorCode.value.trim(),
        forWhom  : solidForWhom.value.trim(),
        pattern  : solidPattern.value.trim(),
        quality  : solidQuality.value.trim(),
        status   : solidStatus.value,
        date     : solidDate.value,
        qtyKg    : solidQtyKg.value ? Number(solidQtyKg.value) : 0,
        receivedAt: existingReceivedAt
      };

      if (!data.colorText ||
          !data.forWhom ||
          !data.status ||
          !data.date ||
          !data.qtyKg) {

        solidMsg.textContent = "Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø¦ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ù„ÙˆÙ†ØŒ Ù„ØµØ§Ù„Ø­ Ù…ÙŠÙ†ØŒ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„ÙƒÙ…ÙŠØ©).";
        solidMsg.style.color = "red";
        return;
      }

      try {
        if (solidEditId === null) {
          const newData = {
            ...data,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          await db.collection("solid_orders").add(newData);
          solidMsg.textContent = "ØªÙ… Ø­ÙØ¸ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…";
        } else {
          await db.collection("solid_orders").doc(solidEditId).update(data);
          solidMsg.textContent = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø·Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…";
        }
        solidMsg.style.color = "green";
        clearSolidForm();
        setTimeout(() => { solidMsg.textContent = ""; }, 2000);
      } catch (err) {
        console.error(err);
        solidMsg.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸ØŒ ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Firestore.";
        solidMsg.style.color = "red";
      }
    }

    solidSaveBtn.addEventListener("click", saveSolidOrder);

    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø© (ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… / Ù„Ù… ÙŠØ³ØªÙ„Ù…)
    function setSolidFilter(filter) {
      solidFilter = filter;
      [filterAll, filterReceived, filterNotReceived].forEach(btn => btn.classList.remove("active"));
      if (filter === "all") filterAll.classList.add("active");
      if (filter === "received") filterReceived.classList.add("active");
      if (filter === "not_received") filterNotReceived.classList.add("active");
      renderSolidTable();
    }

    filterAll.addEventListener("click", () => setSolidFilter("all"));
    filterReceived.addEventListener("click", () => setSolidFilter("received"));
    filterNotReceived.addEventListener("click", () => setSolidFilter("not_received"));

    // ÙÙ„Ø§ØªØ± Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ù„Ø¹Ù…ÙŠÙ„ / Ø§Ù„Ø®Ø§Ù…Ø© / Ø§Ù„ØªØ§Ø±ÙŠØ®)
    function updateExtraFilters() {
      filterClientText   = filterClient.value.trim().toLowerCase();
      filterQualityText  = filterQualityF.value.trim().toLowerCase();
      filterDateFromVal  = filterDateFrom.value;
      filterDateToVal    = filterDateTo.value;
      renderSolidTable();
    }

    filterClient.addEventListener("input", updateExtraFilters);
    filterQualityF.addEventListener("input", updateExtraFilters);
    filterDateFrom.addEventListener("change", updateExtraFilters);
    filterDateTo.addEventListener("change", updateExtraFilters);

    filterReset.addEventListener("click", () => {
      filterClient.value   = "";
      filterQualityF.value = "";
      filterDateFrom.value = "";
      filterDateTo.value   = "";
      filterClientText     = "";
      filterQualityText    = "";
      filterDateFromVal    = "";
      filterDateToVal      = "";
      setSolidFilter("all"); // ÙŠØ±Ø¬Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ÙƒÙ„
      renderSolidTable();
    });

    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ø­Ø°Ù / Ø§Ø³ØªÙ„Ø§Ù… / Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… / ØªØ¹Ø¯ÙŠÙ„ / ØªØ´ÙƒÙŠÙ„)
    async function handleTableClick(e) {
      const target = e.target;
      const action = target.dataset.action;
      const id     = target.dataset.id;
      if (!action || !id) return;

      if (action === "delete") {
        const ok = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ");
        if (!ok) return;
        try {
          await db.collection("solid_orders").doc(id).delete();
        } catch (err) {
          console.error(err);
          alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­Ø°ÙØŒ ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Firestore.");
        }
      }

      if (action === "receive") {
        const now = new Date();
        const dateStr = now.toLocaleString("ar-EG");
        try {
          await db.collection("solid_orders").doc(id).update({ receivedAt: dateStr });
        } catch (err) {
          console.error(err);
          alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«ØŒ ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Firestore.");
        }
      }

      if (action === "unreceive") {
        const ok = confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ");
        if (!ok) return;
        try {
          await db.collection("solid_orders").doc(id).update({ receivedAt: null });
        } catch (err) {
          console.error(err);
          alert("Ù„Ù… ÙŠØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…ØŒ ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Firestore.");
        }
      }

      if (action === "form") {
        // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„ ÙˆØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨ Ø¨ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
        const today = todayISO();
        try {
          await db.collection("solid_orders").doc(id).update({
            status: "ØªÙ… Ø§Ù„ØªØ´ÙƒÙŠÙ„",
            date: today
          });
        } catch (err) {
          console.error(err);
          alert("Ù„Ù… ÙŠØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„ØªØ´ÙƒÙŠÙ„Ø§ØªØŒ ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Firestore.");
        }
      }

      if (action === "edit") {
        const orderObj = solidOrders.find(o => o.id === id);
        if (!orderObj) return;
        const order = orderObj.data;

        solidColorText.value = order.colorText;
        solidColorCode.value = order.colorCode || "";
        solidForWhom.value   = order.forWhom;
        solidPattern.value   = order.pattern;
        solidQuality.value   = order.quality || "";
        solidStatus.value    = order.status;
        solidDate.value      = order.date;
        solidQtyKg.value     = order.qtyKg;
        solidEditId          = id;

        solidSaveBtn.textContent = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ (Ø³Ø§Ø¯Ø©)";
        solidMsg.textContent = "Ø£Ù†ØªÙ Ø§Ù„Ø¢Ù† ÙÙŠ ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ù„Ø·Ù„Ø¨ Ù…Ø­Ø¯Ø¯.";
        solidMsg.style.color = "blue";
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    }

    labTableBody.addEventListener("click", handleTableClick);
    solidTableBody.addEventListener("click", handleTableClick);

    /************ AutoComplete Ù„Ù„Ø®Ø§Ù…Ø© ************/
    function renderQualitySuggestions(list) {
      if (!list || list.length === 0) {
        qualitySuggestions.classList.add("hidden");
        qualitySuggestions.innerHTML = "";
        return;
      }
      qualitySuggestions.innerHTML = "";
      list.forEach(q => {
        const div = document.createElement("div");
        div.className = "suggestion-item";
        div.textContent = q;
        div.addEventListener("mousedown", (e) => {
          e.preventDefault();
          solidQuality.value = q;
          qualitySuggestions.classList.add("hidden");
        });
        qualitySuggestions.appendChild(div);
      });
      qualitySuggestions.classList.remove("hidden");
    }

    solidQuality.addEventListener("input", () => {
      const val = solidQuality.value.trim();
      if (!val) {
        renderQualitySuggestions([]);
        return;
      }
      const filtered = qualityList.filter(q =>
        q.toLowerCase().includes(val.toLowerCase())
      );
      renderQualitySuggestions(filtered);
    });

    solidQuality.addEventListener("focus", () => {
      const val = solidQuality.value.trim();
      if (!val) return;
      const filtered = qualityList.filter(q =>
        q.toLowerCase().includes(val.toLowerCase())
      );
      renderQualitySuggestions(filtered);
    });

    document.addEventListener("click", (e) => {
      if (!qualitySuggestions.contains(e.target) && e.target !== solidQuality) {
        qualitySuggestions.classList.add("hidden");
      }
    });

    /************ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ù† Firestore ************/
    db.collection("solid_orders")
      .orderBy("createdAt", "asc")
      .onSnapshot((snapshot) => {
        solidOrders = snapshot.docs.map(doc => ({
          id: doc.id,
          data: doc.data()
        }));
        renderTables();
      }, (error) => {
        console.error("Firestore listen error:", error);
        solidMsg.textContent = "Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ùˆ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª).";
        solidMsg.style.color = "red";
      });
  </script>
</body>
</html>
