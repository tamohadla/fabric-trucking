<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تشكيلات القماش المطبوع</title>
  <link rel="stylesheet" href="./css/base.css" />
  <link rel="stylesheet" href="./css/components.css" />
  <link rel="stylesheet" href="./css/desktop.css" />
  <link rel="stylesheet" href="./css/mobile.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">تشكيلات القماش المطبوع</div>
    <nav class="nav">
      <a class="nav-link" href="../index.html">قماش سادة</a>
      <a class="nav-link active" href="./printed.html">قماش مطبوع</a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <h2>إدخال / مراجعة مرياجات الرسمة</h2>

      <div class="form-row">
        <div class="field grow">
          <label>رقم / كود الرسمة</label>
          <input id="in_designcode" type="text" placeholder="مثال: 13228" />
        </div>
        <div class="field grow">
          <label>عدد الشبلونات</label>
          <input id="in_screenscount" type="number" min="0" placeholder="مثال: 3" />
        </div>
      </div>

      <div class="subcard">
        <h3>مرياج رقم <span id="mariageSeqLabel">1</span></h3>

        <div class="form-grid">
          <div class="field">
            <label>رقم المرياج</label>
            <input id="in_mariagenumber" type="number" min="1" placeholder="مثال: 1" />
          </div>

          <div class="field">
            <label>نوع الطباعة</label>
            <select id="in_printtype">
              <option value="">اختيار النوع…</option>
              <option>بجمعت</option>
              <option>راكف</option>
              <option>روتاري</option>
              <option>ديجيتال</option>
            </select>
          </div>

          <div class="field">
            <label>تحضير الأرضية</label>
            <select id="in_groundprep">
              <option value="">اختيار…</option>
              <option>أوفوايت</option>
              <option>أوفوايت + برايمر</option>
              <option>تبييض</option>
            </select>
          </div>

          <div class="field">
            <label>الخامة</label>
            <input id="in_rawmaterial" type="text" placeholder="مثال: قطن فل ليكرا" />
          </div>

          <div class="field">
            <label>الجودة</label>
            <input id="in_grade" type="text" placeholder="أولى / ثانية …" />
          </div>

          <div class="field">
            <label>الكمية (كغ)</label>
            <input id="in_qtykg" type="number" min="0" step="0.01" placeholder="مثال: 400" />
          </div>

          <div class="field">
            <label>تاريخ الطلب</label>
            <input id="in_orderdate" type="date" />
          </div>

          <div class="field">
            <label>حالة الطلب</label>
            <select id="in_status">
              <option>لم يتم التشكيل</option>
              <option>تم التشكيل</option>
              <option>تحت التشغيل</option>
              <option>تم الاستلام</option>
            </select>
          </div>

          <div class="field grow2">
            <label>ملاحظات</label>
            <textarea id="in_notes" rows="2" placeholder="مثال: تعديل بسيط في اللون…"></textarea>
          </div>

          <div class="field grow2">
            <label>صورة المرياج (ملف أو كاميرا)</label>
            <input id="in_image" type="file" accept="image/*" />
            <div class="hint">الصورة تُحفظ باسم واضح: printed/&lt;رقم الرسمة&gt;/&lt;رقم الرسمة&gt;_m&lt;رقم المرياج&gt;.&lt;ext&gt;</div>
          </div>
        </div>

        <div class="actions-row">
          <button class="btn" id="btn_addMariage">إضافة مرياج جديد</button>
          <button class="btn primary" id="btn_saveMariages">حفظ كل المرياجات</button>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>جدول تشكيلات المطبوع</h2>

      <div class="toolbar">
        <div class="field grow">
          <label>بحث</label>
          <input id="searchBox" type="text" placeholder="بحث برقم الرسمة / رقم المرياج / الخام…"/>
        </div>

        <div class="field">
          <label>فلترة حسب الحالة</label>
          <select id="statusFilter">
            <option value="all">كل الحالات</option>
            <option value="لم يتم التشكيل">لم يتم التشكيل</option>
            <option value="تم التشكيل">تم التشكيل</option>
            <option value="تحت التشغيل">تحت التشغيل</option>
            <option value="تم الاستلام">تم الاستلام</option>
          </select>
        </div>

        <div class="field">
          <label>ترتيب حسب</label>
          <select id="sortBy">
            <option value="order_date_desc">تاريخ الطلب (من الأحدث)</option>
            <option value="order_date_asc">تاريخ الطلب (من الأقدم)</option>
            <option value="designcode_desc">رقم الرسمة (تنازلي)</option>
            <option value="designcode_asc">رقم الرسمة (تصاعدي)</option>
          </select>
        </div>
      </div>

      <div class="table-wrap">
        <table class="tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>الصورة</th>
              <th>رقم الرسمة</th>
              <th>عدد الشبلونات</th>
              <th>رقم المرياج</th>
              <th>نوع الطباعة</th>
              <th>تحضير الأرضية</th>
              <th>الخامة</th>
              <th>الجودة</th>
              <th>الكمية (كغ)</th>
              <th>تاريخ الطلب</th>
              <th>حالة الطلب</th>
              <th>ملاحظات</th>
              <th>إجراءات</th>
            </tr>
          </thead>
          <tbody id="rowsBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Edit Modal -->
  <div id="editModalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <button class="modal-close" id="editModalClose" aria-label="Close">×</button>
      <h3>تعديل بيانات المرياج</h3>

      <div class="modal-grid">
        <div class="field grow">
          <label>رقم الرسمة</label>
          <input id="edit_designcode" disabled />
        </div>
        <div class="field grow">
          <label>عدد الشبلونات</label>
          <input id="edit_screenscount" disabled />
        </div>

        <div class="field grow">
          <label>رقم المرياج</label>
          <input id="edit_mariagenumber" type="number" min="1" />
          <div class="hint">إذا غيّرت رقم المرياج يجب اختيار صورة جديدة حتى نعيد تسميتها بشكل صحيح.</div>
        </div>

        <div class="field grow">
          <label>نوع الطباعة</label>
          <input id="edit_printtype" />
        </div>

        <div class="field grow">
          <label>تحضير الأرضية</label>
          <input id="edit_groundprep" />
        </div>

        <div class="field grow">
          <label>الخامة</label>
          <input id="edit_rawmaterial" />
        </div>

        <div class="field grow">
          <label>الجودة</label>
          <input id="edit_grade" />
        </div>

        <div class="field grow">
          <label>الكمية (كغ)</label>
          <input id="edit_qtykg" type="number" min="0" step="0.01" />
        </div>

        <div class="field grow">
          <label>تاريخ الطلب</label>
          <input id="edit_orderdate" type="date" />
        </div>

        <div class="field grow">
          <label>حالة الطلب</label>
          <select id="edit_status">
            <option>لم يتم التشكيل</option>
            <option>تم التشكيل</option>
            <option>تحت التشغيل</option>
            <option>تم الاستلام</option>
          </select>
        </div>

        <div class="field grow2">
          <label>ملاحظات</label>
          <textarea id="edit_notes" rows="2"></textarea>
        </div>

        <div class="field grow2">
          <label>صورة المرياج</label>
          <div class="inline">
            <img id="edit_preview" class="thumb-lg" alt="صورة المرياج" />
            <div class="stack">
              <input id="edit_image" type="file" accept="image/*" />
              <button class="btn" id="editUpdateImageBtn" type="button">تحديث الصورة</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn primary" id="editSaveBtn">حفظ التعديلات</button>
      </div>
    </div>
  </div>

  <!-- Duplicate Modal -->
  <div id="dupModalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <button class="modal-close" id="dupModalClose" aria-label="Close">×</button>
      <h3>تكرار الطلب</h3>

      <div class="modal-grid">
        <div class="field grow">
          <label>رقم الرسمة</label>
          <input id="dup_designcode" disabled />
        </div>
        <div class="field grow">
          <label>عدد الشبلونات</label>
          <input id="dup_screenscount" disabled />
        </div>
        <div class="field grow">
          <label>رقم المرياج</label>
          <input id="dup_mariagenumber" disabled />
        </div>

        <div class="field grow">
          <label>نوع الطباعة</label>
          <input id="dup_printtype" />
        </div>

        <div class="field grow">
          <label>تحضير الأرضية</label>
          <input id="dup_groundprep" />
        </div>

        <div class="field grow">
          <label>الخامة</label>
          <input id="dup_rawmaterial" />
        </div>

        <div class="field grow">
          <label>الجودة</label>
          <input id="dup_grade" />
        </div>

        <div class="field grow">
          <label>الكمية (كغ)</label>
          <input id="dup_qtykg" type="number" min="0" step="0.01" />
        </div>

        <div class="field grow">
          <label>تاريخ الطلب</label>
          <input id="dup_orderdate" type="date" />
        </div>

        <div class="field grow">
          <label>حالة الطلب</label>
          <select id="dup_status">
            <option>لم يتم التشكيل</option>
            <option>تم التشكيل</option>
            <option>تحت التشغيل</option>
            <option>تم الاستلام</option>
          </select>
        </div>

        <div class="field grow2">
          <label>ملاحظات</label>
          <textarea id="dup_notes" rows="2"></textarea>
        </div>

        <div class="field grow2">
          <label>الصورة (مرجعية)</label>
          <img id="dup_preview" class="thumb-lg" alt="صورة المرياج" />
          <div class="hint">سيتم استخدام نفس صورة المرياج المرجعية.</div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn primary" id="dupSaveBtn">حفظ الطلب المكرر</button>
      </div>
    </div>
  </div>

  <!-- Image Viewer Modal -->
  <div id="imageModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <button class="modal-close" id="imageModalClose" aria-label="Close">×</button>
      <img id="imageModalImg" class="image-viewer" alt="صورة" />
    </div>
  </div>

 <!-- Supabase CDN (لازم يكون قبل أي كود يستخدم window.supabase) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- تشغيل التطبيق -->
<script type="module" src="./js/app.js"></script>
</body>
</html>
</body>
</html>
